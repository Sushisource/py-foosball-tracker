<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" name="viewport"
          content="width=device-width, initial-scale=1.0">
    <script src="/static/js/game_saver.js"></script>
    <title>Record Foosball Game</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/foosball.css" rel="stylesheet">
</head>
<body>
<div class="container">
    <h2>Record your foosball game!</h2>

    <div class="jumbotron">
        <div id="gamerec"></div>
    </div>
</div>
</body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/static/js/bootstrap/bootstrap.min.js"></script>
<script type="text/javascript">
    // JQuery is stupid, and doesn't respect the types provided in $.post
    $.ajaxSetup({
        contentType: "application/json; charset=utf-8"
    });
    // get an empty <div>
    var div = document.getElementById('gamerec');

    var startingState = null;
    var gamerecmvc = Elm.embed(Elm.GameSaver, div, {wipeModel: false});
    gamerecmvc.ports.setStorage.subscribe(function (state) {
        console.log(JSON.stringify(state));
        $.post("/historical_games",
                JSON.stringify({"player_list": state.players}),
                function (res) {
                    gamerecmvc.ports.wipeModel.send(res.save);
                }, 'json')
    });

</script>
</html>